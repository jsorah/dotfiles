---
- hosts: localhost 
  tasks:
    - name: check if cargo is installed
      ansible.builtin.shell: command -v cargo
      register: cargo_exists
      ignore_errors: yes
    - name: check if go is installed
      ansible.builtin.shell: command -v go
      register: go_exists
      ignore_errors: yes
    - name: check if minikube is installed
      ansible.builtin.shell: command -v minikube
      register: minikube_exists
      ignore_errors: yes
    - name: check if sdkman is installed
      ansible.builtin.stat:
        path: "{{ ansible_env.HOME }}/.sdkman/bin/sdkman-init.sh"
      register: sdkman_exists
      ignore_errors: yes
    - name: Download Cargo Installer
      when: cargo_exists is failed
      ansible.builtin.get_url:
        url: https://sh.rustup.rs
        dest: /tmp/sh.rustup.rs
        mode: '0755'
        force: 'yes'
      tags:
        - rust
    - name: install rust/cargo
      when: cargo_exists is failed
      ansible.builtin.shell: /tmp/sh.rustup.rs -y
      tags:
        - rust
    # go
    - name: install go
      when: go_exists is failed
      ansible.builtin.unarchive:
        src: https://go.dev/dl/go1.18.1.linux-amd64.tar.gz
        remote_src: yes
        dest: "{{ ansible_env.HOME}}/.local/"
      tags:
        - go
    - name: link to go bins
      when: go_exists is failed
      ansible.builtin.file:
        src: "{{ item.src }}"
        path: "{{ item.path }}"
        state: "link"
      loop:
        - src: "{{ ansible_env.HOME}}/.local/go/bin/go"
          path: "{{ ansible_env.HOME}}/.local/bin/go"
        - src: "{{ ansible_env.HOME}}/.local/go/bin/gofmt"
          path: "{{ ansible_env.HOME}}/.local/bin/gofmt"

    # sdkman ?
    - name: download sdkman
      when: sdkman_exists is failed
      ansible.builtin.get_url:
        url: "https://get.sdkman.io?rcupdate=false"
        dest: "/tmp/sdkman-inst.sh"
        mode: "a+x"
    - name: install sdkman
      when: sdkman_exists is failed
      ansible.builtin.script: /tmp/sdkman-inst.sh
    # sdkman java, quarkus, maven, gradle ?
    # nvm ?
    - name: install minikube
      when: minikube_exists is failed
      ansible.builtin.get_url:
        url: "https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64"
        dest: "{{ ansible_env.HOME }}/.local/bin/minikube"
        mode: "a+x"
      tags:
        - minikube
    - name: copy bashrc.d files
      ansible.builtin.copy:
        src: "files/bashrc.d/"
        dest: "{{ ansible_env.HOME}}/.bashrc.d"


